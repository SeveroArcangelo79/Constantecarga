<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>RC: Carga y Descarga de un Capacitor</title><style>:root{--bg:#ffffff;--panel:#f3f3f3;--grid:#d7d7d7;--text:#1f1f1f;--brown-light:#efe7df;--accent:#12a4d9;--ok:#12b886;--border:#e0e0e0}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--bg);color:var(--text);padding:15px;min-height:100vh}.app-container{display:flex;gap:15px;height:calc(100vh - 30px);max-width:1400px;margin:0 auto}.left-panel{flex:0 0 480px;display:flex;flex-direction:column;background:var(--bg)}.panel-title{font-size:16px;font-weight:600;margin-bottom:10px;color:var(--text)}.table-container{flex:1;overflow:auto;border:1px solid var(--border);border-radius:6px;background:var(--bg)}table{width:100%;border-collapse:collapse;font-size:13px}thead{position:sticky;top:0;background:var(--panel);z-index:10}th{padding:10px 6px;text-align:left;font-weight:600;border-bottom:2px solid var(--border);white-space:nowrap}td{padding:6px;border-bottom:1px solid var(--border)}tr:nth-child(even){background:var(--brown-light)}tr:hover{background:#e8f4fc}tr.selected{background:#cce7f5!important}input[type="text"],input[type="number"],select{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:13px;background:white}input[type="text"]:focus,input[type="number"]:focus,select:focus{outline:none;border-color:var(--accent)}input[type="checkbox"]{width:18px;height:18px;cursor:pointer}.col-check{width:40px;text-align:center}.col-name{min-width:80px}.col-mode{width:95px}.col-param{width:75px}.col-color{width:100px}.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}.btn{padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all 0.2s}.btn:active{transform:scale(0.97)}.btn-primary{background:var(--accent);color:white}.btn-primary:hover{background:#0d8ab8}.btn-secondary{background:var(--panel);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{background:#e5e5e5}.btn-danger{background:#fee;color:#c00;border:1px solid #fcc}.btn-danger:hover{background:#fdd}.spacer{flex:1}.center-panel{flex:1;display:flex;flex-direction:column;min-width:400px}.canvas-container{flex:1;border:1px solid var(--border);border-radius:6px;background:var(--bg);position:relative;min-height:400px}canvas{width:100%;height:100%;display:block}.cursor-label{padding:8px;font-size:13px;color:#404040;font-weight:500;background:var(--panel);border-radius:4px;margin-top:8px}.right-panel{flex:0 0 220px;display:flex;flex-direction:column}.options-form{display:flex;flex-direction:column;gap:12px}.form-row{display:flex;flex-direction:column;gap:4px}.form-row label{font-size:13px;font-weight:500;color:#555}.form-row-inline{display:flex;gap:6px}.form-row-inline input{flex:1}.form-row-inline select{width:60px;flex:none}.checkbox-row{display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer}.checkbox-row input{width:16px;height:16px}.units-section{background:var(--panel);border-radius:6px;padding:12px;margin:8px 0}.section-title{font-size:12px;font-weight:600;color:#555;margin-bottom:10px;text-transform:uppercase;letter-spacing:0.5px}.units-section .form-row{margin-bottom:8px}.units-section .form-row:last-child{margin-bottom:0}.help-box{background:var(--brown-light);border-radius:6px;padding:12px;font-size:12px;line-height:1.6;color:#555;margin-top:15px}.help-box strong{color:var(--text)}.legend{position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.95);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-size:12px;max-width:200px}.legend-item{display:flex;align-items:center;gap:8px;margin-bottom:4px}.legend-item:last-child{margin-bottom:0}.legend-color{width:20px;height:3px;border-radius:2px}@media(max-width:1100px){.app-container{flex-direction:column;height:auto}.left-panel{flex:none;max-height:350px}.center-panel{min-height:400px}.right-panel{flex:none}}</style></head><body><div class="app-container"><div class="left-panel"><div class="panel-title">Escenarios</div><div class="table-container"><table id="scenarioTable"><thead><tr><th class="col-check">Act.</th><th class="col-name">Nombre</th><th class="col-mode">Modo</th><th class="col-param">C (µF)</th><th class="col-param">R (Ω)</th><th class="col-param">Vs (V)</th><th class="col-param">V0 (V)</th><th class="col-color">Color</th></tr></thead><tbody id="tableBody"></tbody></table></div><div class="controls"><button class="btn btn-secondary" onclick="addRow()">Agregar fila</button> <button class="btn btn-danger" onclick="removeSelectedRow()">Eliminar fila</button><div class="spacer"></div><button class="btn btn-secondary" onclick="exportCSV()">Exportar CSV</button> <button class="btn btn-primary" onclick="recomputePlot()">Graficar</button></div></div><div class="center-panel"><div class="panel-title">Representación en el Dominio del Tiempo</div><div class="canvas-container"><canvas id="plotCanvas"></canvas><div class="legend" id="legend"></div></div><div class="cursor-label" id="cursorLabel">Cursor: (mueva el mouse sobre el gráfico)</div></div><div class="right-panel"><div class="panel-title">Opciones</div><div class="options-form"><div class="form-row"><label>Duración Total</label><div class="form-row-inline"><input type="number" id="tmax" value="0.5" min="0.000001" step="0.1"><select id="timeUnit" onchange="updateTimeUnit()"><option value="S">S</option><option value="mS">mS</option></select></div></div><div class="form-row"><label>Magnitud</label><select id="magnitude" onchange="recomputePlot()"><option value="voltage">Tensión en el capacitor Vc (Volts)</option><option value="current">Corriente I (Amper)</option><option value="charge">Carga Q (Coulombs)</option></select></div><div class="units-section"><div class="section-title">Unidades de Entrada</div><div class="form-row"><label>Capacidad (C)</label><select id="unitC" onchange="updateTableHeaders(); recomputePlot()"><option value="F">F (Faradios)</option><option value="mF">mF (miliFaradios)</option><option value="µF" selected>µF (microFaradios)</option><option value="nF">nF (nanoFaradios)</option><option value="pF">pF (picoFaradios)</option></select></div><div class="form-row"><label>Resistencia (R)</label><select id="unitR" onchange="updateTableHeaders(); recomputePlot()"><option value="Ω" selected>Ω (Ohm)</option><option value="kΩ">kΩ (kiloOhm)</option><option value="MΩ">MΩ (MegaOhm)</option></select></div></div><label class="checkbox-row"><input type="checkbox" id="markTau" checked onchange="recomputePlot()"> Marcar τ = R·C</label><label class="checkbox-row"><input type="checkbox" id="autorange" checked onchange="recomputePlot()"> Autoajuste de ejes</label></div><div class="help-box"><strong>Notas:</strong><br><br>• Selecciona unidad (S o mS) arriba.<br><br>• <strong>Carga:</strong> Vc sube hasta Vs.<br><br>• <strong>Descarga:</strong> Vc baja desde V0 hasta 0.<br><br>• <strong>τ (tau) = R·C</strong> determina la velocidad de carga/descarga.</div></div></div><script>
(()=>{const M=Math,W=window,D=document,I=e=>D.getElementById(e),F64=Float64Array,Cols={"Celeste":"#12a4d9","Verde":"#12b886","Rojo":"#d91212","Naranja":"#ff9f1c","Violeta":"#9b5de5","Marrón":"#8b5e34","Gris Oscuro":"#555555","Negro":"#000000","Azul Oscuro":"#003366"},UM={'F':1,'mF':1e-3,'µF':1e-6,'nF':1e-9,'pF':1e-12,'Ω':1,'kΩ':1e3,'MΩ':1e6},Pts=2e3;let selIdx=-1,lUnit="S";const calcRC=(t,mode,C,R,Vs,V0)=>{let n=t.length,Vc=new F64(n),Ii=new F64(n),Q=new F64(n),tau=null,hasI=!0;if(R===null||R===0){for(let i=0;i<n;i++){Vc[i]=(mode==="CARGA")?Vs:0;Q[i]=C*Vc[i]}return{Vc,I:null,Q,tau:null,hasI:!1}}tau=R*C;let mConst=1/tau;if(mode==="CARGA")for(let i=0;i<n;i++){let e=M.exp(-t[i]*mConst);Vc[i]=Vs*(1.0-e);Ii[i]=(Vs-Vc[i])/R;Q[i]=C*Vc[i]}else for(let i=0;i<n;i++){let e=M.exp(-t[i]*mConst);Vc[i]=V0*e;Ii[i]=-Vc[i]/R;Q[i]=C*Vc[i]}return{Vc,I:Ii,Q,tau,hasI}},ls=(s,e,n)=>{let a=new F64(n),st=(e-s)/(n-1);for(let i=0;i<n;i++)a[i]=s+i*st;return a},fmtEng=v=>(v===0)?"0":v.toPrecision(6),fmtAx=v=>{if(v===0)return"0";let av=M.abs(v);if(av>=1000)return v.toFixed(0);if(av>=100)return v.toFixed(1);if(av>=10)return v.toFixed(2);if(av>=1)return v.toFixed(3);if(av>=0.1)return v.toFixed(4);if(av>=0.01)return v.toFixed(5);if(av>=0.001)return v.toFixed(6);return v.toFixed(7).replace(/\.?0+$/,'')};W.updateTableHeaders=()=>{let uC=I('unitC').value,uR=I('unitR').value,hs=D.querySelectorAll('#scenarioTable thead th');hs[3].textContent=`C (${uC})`;hs[4].textContent=`R (${uR})`};const mkSel=(vals,sel,fn)=>{let h=`<select onchange="${fn}">`;for(let k in vals)h+=`<option value="${k}" ${(k===sel)?'selected':''}>${k}</option>`;return h+'</select>'},mkColSel=sel=>{let h='<select onchange="recomputePlot()">';for(let k in Cols)h+=`<option value="${k}" ${(k===sel)?'selected':''}>${k}</option>`;return h+'</select>'},mkModeSel=s=>`<select onchange="recomputePlot()"><option value="CARGA" ${(s==="CARGA"?'selected':'')}>CARGA</option><option value="DESCARGA" ${(s==="DESCARGA"?'selected':'')}>DESCARGA</option></select>`,getData=tr=>{let ips=tr.querySelectorAll('input, select');let nm=ips[1].value||"Fila",md=ips[2].value,rawC=parseFloat(ips[3].value.replace(',','.'))||1,rawR=ips[4].value.trim(),rawVs=parseFloat(ips[5].value.replace(',','.'))||5,rawV0=parseFloat(ips[6].value.replace(',','.'))||5,cn=ips[7].value,col=Cols[cn]||Cols["Celeste"];let mC=UM[I('unitC').value],mR=UM[I('unitR').value];let finalR=(rawR==='')?null:(parseFloat(rawR.replace(',','.'))*mR);return{act:ips[0].checked,name:nm,mode:md,C:rawC*mC,R:finalR,Vs:rawVs,V0:rawV0,color:col,cn:cn}};W.addRow=(act=true,name="Caso",mode="CARGA",C="100",R="1000",Vs="5",V0="5",color="Celeste")=>{let tb=I('tableBody'),ri=tb.children.length,tr=D.createElement('tr');tr.onclick=(e)=>selRowF(ri,e);tr.innerHTML=`<td class="col-check"><input type="checkbox" ${(act?'checked':'')} onchange="recomputePlot()"></td><td class="col-name"><input type="text" value="${name}" onchange="recomputePlot()"></td><td class="col-mode">${mkModeSel(mode)}</td><td class="col-param"><input type="text" value="${C}" onchange="recomputePlot()"></td><td class="col-param"><input type="text" value="${R}" onchange="recomputePlot()"></td><td class="col-param"><input type="text" value="${Vs}" onchange="recomputePlot()"></td><td class="col-param"><input type="text" value="${V0}" onchange="recomputePlot()"></td><td class="col-color">${mkColSel(color)}</td>`;tb.appendChild(tr);W.recomputePlot()};const selRowF=(idx,ev)=>{if(ev.target.tagName==='INPUT'||ev.target.tagName==='SELECT')return;let rs=D.querySelectorAll('#tableBody tr');rs.forEach((r,i)=>r.classList.toggle('selected',i===idx));selIdx=idx};W.removeSelectedRow=()=>{let tb=I('tableBody');if(tb.children.length===0)return;let rm=(selIdx>=0)?selIdx:tb.children.length-1;tb.children[rm].remove();selIdx=-1;W.recomputePlot()};W.updateTimeUnit=()=>{let s=I('timeUnit'),i=I('tmax'),nu=s.value,v=parseFloat(i.value);if(lUnit!==nu){if(lUnit==="S"&&nu==="mS")i.value=v*1e3;else if(lUnit==="mS"&&nu==="S")i.value=v/1e3;lUnit=nu;W.recomputePlot()}};W.recomputePlot=()=>{let cv=I('plotCanvas'),ct=cv.getContext('2d'),ctn=cv.parentElement;cv.width=ctn.clientWidth;cv.height=ctn.clientHeight;let Wz=cv.width,Hz=cv.height,Mgn={t:40,r:30,b:50,l:70},Pw=Wz-Mgn.l-Mgn.r,Ph=Hz-Mgn.t-Mgn.b;let tm=parseFloat(I('tmax').value)||0.5;if(I('timeUnit').value==="mS")tm/=1e3;let mag=I('magnitude').value,mTau=I('markTau').checked,auto=I('autorange').checked,timeVec=ls(0,tm,Pts),crvs=[],trs=D.querySelectorAll('#tableBody tr');trs.forEach(tr=>{let d=getData(tr);if(!d.act)return;try{let res=calcRC(timeVec,d.mode,d.C,d.R,d.Vs,d.V0),Y,yl;if(mag==="voltage"){Y=res.Vc;yl="Vc (Volts)"}else if(mag==="current"){if(!res.hasI)return;Y=res.I;yl="I (Amper)"}else{Y=res.Q;yl="Q (Coulombs)"}crvs.push({t:timeVec,y:Y,nm:d.name,md:d.mode,cl:d.color,tau:res.tau,yl:yl})}catch(e){console.log(e)}});let yMin=0,yMax=1;if(crvs.length>0&&auto){yMin=Infinity;yMax=-Infinity;crvs.forEach(c=>{for(let v of c.y){if(v<yMin)yMin=v;if(v>yMax)yMax=v}});let pd=(yMax-yMin)*0.1||0.1;yMin-=pd;yMax+=pd}const sX=v=>Mgn.l+(v/tm)*Pw,sY=v=>Mgn.t+Ph-((v-yMin)/(yMax-yMin))*Ph;ct.fillStyle='#fff';ct.fillRect(0,0,Wz,Hz);ct.strokeStyle='#e0e0e0';ct.lineWidth=1;for(let i=0;i<=10;i++){let x=Mgn.l+(i/10)*Pw;ct.beginPath();ct.moveTo(x,Mgn.t);ct.lineTo(x,Mgn.t+Ph);ct.stroke()}for(let i=0;i<=8;i++){let y=Mgn.t+(i/8)*Ph;ct.beginPath();ct.moveTo(Mgn.l,y);ct.lineTo(Mgn.l+Pw,y);ct.stroke()}ct.strokeStyle='#1f1f1f';ct.lineWidth=1.5;ct.strokeRect(Mgn.l,Mgn.t,Pw,Ph);ct.fillStyle='#1f1f1f';ct.font='12px Segoe UI, sans-serif';ct.textAlign='center';for(let i=0;i<=10;i++){let v=(i/10)*tm,vms=M.round(v*1e3);ct.fillText(vms,sX(v),Mgn.t+Ph+20)}ct.fillText('Tiempo (ms)',Mgn.l+Pw/2,Hz-10);ct.textAlign='right';for(let i=0;i<=8;i++){let v=yMin+(1-i/8)*(yMax-yMin);ct.fillText(fmtAx(v),Mgn.l-8,Mgn.t+(i/8)*Ph+4)}ct.save();ct.translate(15,Mgn.t+Ph/2);ct.rotate(-M.PI/2);ct.textAlign='center';ct.fillText((crvs.length>0?crvs[0].yl:'Magnitud'),0,0);ct.restore();if(crvs.length===0){ct.fillStyle='#666';ct.font='14px Segoe UI';ct.textAlign='center';ct.fillText('No hay curvas activas.',Wz/2,Hz/2)}else{crvs.forEach(c=>{ct.strokeStyle=c.cl;ct.lineWidth=2.5;ct.beginPath();for(let i=0;i<c.t.length;i++){let x=sX(c.t[i]),y=sY(c.y[i]);(i===0)?ct.moveTo(x,y):ct.lineTo(x,y)}ct.stroke();if(mTau&&c.tau!==null&&c.tau>0&&c.tau<=tm){let ti=M.floor((c.tau/tm)*(c.t.length-1)),yt=c.y[ti],xp=sX(c.tau),yp=sY(yt);ct.fillStyle='#12b886';ct.beginPath();ct.arc(xp,yp,6,0,2*M.PI);ct.fill();ct.strokeStyle='#0b5';ct.lineWidth=1.5;ct.stroke();ct.fillStyle='#1f1f1f';ct.font='11px Segoe UI';ct.textAlign='left';ct.fillText(`τ=${M.round(c.tau*1e3)} ms`,xp+8,yp-8)}})}let leg=I('legend');if(crvs.length===0)leg.style.display='none';else{leg.style.display='block';leg.innerHTML=crvs.map(c=>`<div class="legend-item"><div class="legend-color" style="background:${c.cl}"></div><span>${c.nm} [${c.md}]</span></div>`).join('')}};W.exportCSV=()=>{let tm=parseFloat(I('tmax').value)||0.5;if(I('timeUnit').value==="mS")tm/=1e3;let mag=I('magnitude').value,tv=ls(0,tm,Pts),hdr=['t_segundos'],ser=[],trs=D.querySelectorAll('#tableBody tr');trs.forEach(tr=>{let d=getData(tr);if(!d.act)return;let res=calcRC(tv,d.mode,d.C,d.R,d.Vs,d.V0),Y,sx;if(mag==="voltage"){Y=res.Vc;sx="Volts"}else if(mag==="current"){if(!res.hasI)return;Y=res.I;sx="Amper"}else{Y=res.Q;sx="Coulombs"}hdr.push(`${d.name.replace(/\s+/g,'_')}_${d.mode}_${sx}`);ser.push(Y)});if(ser.length===0){alert('No hay curvas');return}let csv=hdr.join(';')+'\n';for(let i=0;i<tv.length;i++){let r=[fmtEng(tv[i])];ser.forEach(s=>r.push(fmtEng(s[i])));csv+=r.join(';')+'\n'}let bl=new Blob([csv],{type:'text/csv;charset=utf-8;'}),lnk=D.createElement('a');lnk.href=URL.createObjectURL(bl);lnk.download='curvas_rc.csv';lnk.click()};I('plotCanvas').addEventListener('mousemove',e=>{let c=e.target,r=c.getBoundingClientRect(),x=e.clientX-r.left,y=e.clientY-r.top,mg={l:70,t:40,r:30,b:50},pw=c.width-mg.l-mg.r,ph=c.height-mg.t-mg.b;if(x<mg.l||x>mg.l+pw||y<mg.t||y>mg.t+ph)return;let tm=parseFloat(I('tmax').value)||0.5;if(I('timeUnit').value==="mS")tm/=1e3;let tv=xToT(x,mg,pw,tm);let trs=D.querySelectorAll('#tableBody tr'),ymi=0,yma=1,mag=I('magnitude').value;trs.forEach(tr=>{let d=getData(tr);if(!d.act)return;let res=calcRC(ls(0,tm,100),d.mode,d.C,d.R,d.Vs,d.V0);let ay=(mag==="voltage"?res.Vc:(mag==="current"?res.I:res.Q));if(!ay)return;for(let v of ay){if(v<ymi)ymi=v;if(v>yma)yma=v}});let pd=(yma-ymi)*0.1||0.1;ymi-=pd;yma+=pd;let yv=yma-((y-mg.t)/ph)*(yma-ymi);I('cursorLabel').textContent=`Tiempo: ${M.round(tv*1e3)} ms | Valor: ${fmtAx(yv)}`});const xToT=(x,m,w,tm)=>(x-m.l)/w*tm;W.addEventListener('resize',W.recomputePlot);W.addRow(true,"Carga","CARGA","100","1000","5","5","Celeste");W.addRow(true,"Descarga","DESCARGA","100","1000","5","5","Verde");W.updateTableHeaders();})();
</script></body></html>